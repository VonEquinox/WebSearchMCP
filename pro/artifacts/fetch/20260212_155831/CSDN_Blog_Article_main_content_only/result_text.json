{
  "success": true,
  "url": "https://blog.csdn.net/wtyuong/article/details/136691433",
  "via_worker": false,
  "via_playwright": true,
  "text": "import json\nimport pandas as pd\nfrom openpyxl import Workbook, load_workbook\nfrom openpyxl.utils.dataframe import dataframe_to_rows\nimport math\nimport requests\n# 批量获取文章信息并保存到excelclassCSDNArticleExporter:def__init__(self, username, cookies, Referer, page, size, filename):\nself.username = username\nself.cookies = cookies\nself.Referer = Referer\nself.size = size\nself.filename = filename\nself.page = page\ndefget_articles(self):\nurl =\"https://blog.csdn.net/community/home-api/v1/get-business-list\"\nparams ={\"page\":{self.page},\"size\":{self.size},\"businessType\":\"blog\",\"username\":{self.username}}\nheaders ={'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3','Cookie': self.cookies,# Setting the cookies string directly in headers'Referer': self.Referer\n}try:\nresponse = requests.get(url, params=params, headers=headers)\nresponse.raise_for_status()# Raises an HTTPError if the response status code is 4XX or 5XX\ndata = response.json()return data.get('data',{}).get('list',[])except requests.exceptions.HTTPError as e:print(f\"HTTP错误: {e.response.status_code}{e.response.reason}\")except requests.exceptions.RequestException as e:print(f\"请求异常: {e}\")except json.JSONDecodeError:print(\"解析JSON失败\")return[]defexport_to_excel(self):\ndf = pd.DataFrame(self.get_articles())\ndf = df[['title','url','postTime','viewCount','collectCount','diggCount','commentCount']]\ndf.columns =['文章标题','URL','发布时间','阅读量','收藏量','点赞量','评论量']# df.to_excel(self.filename)# 下面的代码会让excel每列都是合适的列宽，如达到最佳阅读效果# 你只用上面的保存也是可以的# Create a new workbook and select the active sheet\nwb = Workbook()\nsheet = wb.active\n# Write DataFrame to sheetfor r in dataframe_to_rows(df, index=False, header=True):\nsheet.append(r)# Iterate over the columns and set column width to the max length in each columnfor column in sheet.columns:\nmax_length =0\ncolumn =[cell for cell in column]for cell in column:try:iflen(str(cell.value))> max_length:\nmax_length =len(cell.value)except:pass\nadjusted_width =(max_length +5)\nsheet.column_dimensions[column[0].column_letter].width = adjusted_width\n# Save the workbook\nwb.save(self.filename)classArticleScores:def__init__(self, filepath):\nself.filepath = filepath\n@staticmethoddefget_article_score(article_url):\nurl =\"https://bizapi.csdn.net/trends/api/v1/get-article-score\"# TODO: Replace with your actual headers\nheaders ={\"Accept\":\"application/json, text/plain, */*\",\"X-Ca-Key\":\"203930474\",\"X-Ca-Nonce\":\"b35e1821-05c2-458d-adae-3b720bb15fdf\",\"X-Ca-Signature\":\"gjeSiKTRCh8aDv0UwThIVRITc/JtGJkgkZoLVeA6sWo=\",\"X-Ca-Signature-Headers\":\"x-ca-key,x-ca-nonce\",\"X-Ca-Signed-Content-Type\":\"multipart/form-data\",}\ndata ={\"url\": article_url}try:\nresponse = requests.post(url, headers=headers, data=data)\nresponse.raise_for_status()# This will raise an error for bad responsesreturn response.json().get('data',{}).get('score','Score not found')except requests.RequestException as e:print(f\"Request failed: {e}\")return\"Error fetching score\"defget_scores_from_excel(self):\ndf = pd.read_excel(self.filepath)\nurls = df['URL'].tolist()\nscores =[self.get_article_score(url)for url in urls]return scores\ndefwrite_scores_to_excel(self):\ndf = pd.read_excel(self.filepath)\ndf['质量分']= self.get_scores_from_excel()\ndf.to_excel(self.filepath, index=False)if __name__ =='__main__':\ntotal =10#已发文章总数量# TODO:调整为你自己的cookies，Referer，CSDNid, headers\ncookies ='uuid_tt_dd=10'# Simplified for brevity\nReferer ='https://blog.csdn.net/WTYuong?type=blog'\nCSDNid ='WTYuong'\nt_index = math.ceil(total/100)+1#向上取整，半闭半开区间，开区间+1。# 获取文章信息# CSDNArticleExporter(\"待查询用户名\", 2（分页数量，按总文章数量/100所得的分页数）,总文章数量仅为设置为全部可见的文章总数。# 100（最大单次查询文章数量不大于100）, 'score1.xlsx'（待保存数据的文件，需要和下面的一致）)for index inrange(1,t_index):#文章总数\nfilename =\"score\"+str(index)+\".xlsx\"\nexporter = CSDNArticleExporter(CSDNid, cookies, Referer, index,100, filename)# Replace with your username\nexporter.export_to_excel()# 批量获取质量分\nscore = ArticleScores(filename)\nscore.write_scores_to_excel()",
  "truncated": false,
  "blocked": true,
  "extractor": "adapter:csdn+trafilatura",
  "quality_score": 86,
  "quality_metrics": {
    "char_len": 3963,
    "line_count": 59,
    "unique_line_ratio": 0.983,
    "noise_line_ratio": 0.0
  },
  "degraded": false
}